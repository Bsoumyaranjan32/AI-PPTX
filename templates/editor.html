<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamma Pro - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            font-family: 'Inter', sans-serif; 
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        
        .presentation-card { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        
        .presentation-card:hover { 
            transform: translateY(-8px) scale(1.02); 
            box-shadow: 0 20px 40px -10px rgba(99, 102, 241, 0.25); 
        }
        
        .delete-btn { 
            opacity: 0; 
            transition: all 0.2s; 
        }
        
        .presentation-card:hover .delete-btn { 
            opacity: 1; 
        }
        
        .mesh-bg { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100vw; 
            height: 100vh; 
            z-index: -1; 
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%), 
                radial-gradient(at 100% 0%, rgba(168, 85, 247, 0.12) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(236, 72, 153, 0.1) 0px, transparent 50%);
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }

        .text-opt,
        .theme-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .text-opt:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
        }

        .text-opt.active {
            background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%) !important;
            border-color: #6366f1 !important;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15) !important;
        }

        .theme-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
        }

        .theme-card.active {
            border-color: #6366f1 !important;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2) !important;
            transform: scale(1.03);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #cbd5e1, #94a3b8);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #94a3b8, #64748b);
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="mesh-bg"></div>

    <div class="min-h-screen flex flex-col">
        
        <!-- ==================== NAVBAR ==================== -->
        <nav class="glass shadow-xl border-b border-white/50 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    
                    <div class="flex items-center space-x-3">
                        <div class="w-11 h-11 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 rounded-2xl flex items-center justify-center text-white font-black shadow-2xl shadow-indigo-500/40 text-xl">
                            G
                        </div>
                        <div>
                            <h1 class="text-xl font-black bg-clip-text text-transparent bg-gradient-to-r from-slate-900 via-indigo-900 to-purple-900 tracking-tight">Gamma Pro</h1>
                            <p class="text-xs text-slate-500 font-semibold">AI Design Studio</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button onclick="openCreateModal()" 
                                class="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-bold hover:shadow-2xl hover:shadow-indigo-500/40 flex items-center gap-2 transition transform hover:scale-105 active:scale-95">
                            <i class="ph-bold ph-plus text-lg"></i> 
                            <span class="hidden sm:inline">New Presentation</span>
                        </button>
                        <button onclick="logout()" 
                                class="p-3 text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-xl transition transform hover:scale-110">
                            <i class="ph-bold ph-sign-out text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ==================== MAIN CONTENT ==================== -->
        <main class="flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-12">
            
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end mb-12 gap-6 animate-fade-in">
                <div>
                    <h2 class="text-4xl font-black text-slate-900 mb-2">Your Presentations</h2>
                    <p class="text-lg text-slate-600 font-medium">Manage and organize your AI-generated decks</p>
                </div>
                <div class="glass px-6 py-3 rounded-xl border border-indigo-200/50 shadow-lg">
                    <div class="flex items-center gap-2">
                        <i class="ph-duotone ph-briefcase text-indigo-600 text-2xl"></i>
                        <div>
                            <p class="text-xs text-slate-500 font-semibold uppercase tracking-wide">Total Projects</p>
                            <p class="text-2xl font-black text-indigo-600"><span id="presentation-count">0</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="presentations-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <div class="col-span-full text-center py-40" id="loading-state">
                    <div class="inline-block animate-spin w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full mb-6"></div>
                    <p class="text-slate-500 font-bold text-lg">Loading your workspace...</p>
                </div>
            </div>

            <div id="empty-state" class="hidden text-center py-40 animate-scale-in">
                <div class="w-32 h-32 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-xl">
                    <i class="ph-duotone ph-slideshow text-6xl text-indigo-600"></i>
                </div>
                <h3 class="text-3xl font-black text-slate-900 mb-3">No presentations yet</h3>
                <p class="text-lg text-slate-600 mb-10 max-w-md mx-auto">Generate your first professional deck in seconds using our advanced AI technology</p>
                <button onclick="openCreateModal()" 
                        class="px-10 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-2xl font-black text-lg hover:shadow-2xl hover:shadow-indigo-500/40 transition transform hover:scale-105 active:scale-95">
                    <i class="ph-fill ph-sparkle mr-2"></i> Create Presentation
                </button>
            </div>
        </main>
    </div>

    <!-- ==================== CREATE MODAL ==================== -->
    <div id="create-modal" class="fixed inset-0 bg-slate-900/70 backdrop-blur-lg z-50 hidden items-center justify-center p-4">
        <div class="relative w-full max-w-5xl glass rounded-3xl shadow-2xl p-10 space-y-8 max-h-[90vh] overflow-y-auto animate-scale-in">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-center sticky top-0 glass pb-6 border-b border-slate-200/60 z-10 -mx-10 -mt-10 px-10 pt-10 rounded-t-3xl">
                <div>
                    <h2 class="text-3xl font-black text-slate-900">Create with AI</h2>
                    <p class="text-slate-600 font-semibold mt-1">Generate stunning presentations instantly</p>
                </div>
                <button onclick="closeCreateModal()" class="text-slate-400 hover:text-slate-600 transition hover:rotate-90 transform duration-300">
                    <i class="ph-bold ph-x text-2xl"></i>
                </button>
            </div>
            
            <!-- Topic Input -->
            <div>
                <label class="block text-sm font-black uppercase text-slate-700 mb-3 tracking-wider flex items-center gap-2">
                    <i class="ph-duotone ph-chat-circle-text text-indigo-600"></i>
                    Topic or Prompt
                </label>
                <textarea id="topic" 
                          rows="3" 
                          class="w-full p-5 border-2 border-slate-200 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 text-lg transition-all placeholder:text-slate-400 font-medium" 
                          placeholder="e.g., Smart Resume Analyzer: Revolutionising Job Applications with AI"></textarea>
            </div>

            <!-- ==================== CUSTOM OUTLINE SECTION ==================== -->
            <div class="pt-2 border-t-2 border-slate-100">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="toggleOutline()">
                    <input type="checkbox" id="use_custom_outline" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 cursor-pointer">
                    <label class="text-sm font-black text-slate-700 select-none cursor-pointer flex items-center gap-2 group-hover:text-indigo-600 transition">
                        <i class="ph-duotone ph-list-bullets text-indigo-600 text-xl"></i>
                        ‚ú® I have my own slide structure (Custom Outline)
                    </label>
                </div>
                
                <div id="outline-box" class="hidden mt-6 space-y-4 animate-slide-up">
                    <div class="flex justify-between items-center mb-4">
                        <label class="block text-sm font-black uppercase text-slate-700 tracking-wider flex items-center gap-2">
                            <i class="ph-fill ph-notebook text-indigo-600"></i>
                            Your Custom Outline
                        </label>
                        <button type="button" onclick="addOutlineCard()" 
                                class="px-4 py-2 bg-gradient-to-r from-indigo-100 to-purple-100 hover:from-indigo-200 hover:to-purple-200 text-indigo-700 text-sm font-bold rounded-xl transition flex items-center gap-2 border-2 border-indigo-200 shadow-sm hover:shadow-md transform hover:scale-105">
                            <i class="ph-bold ph-plus text-lg"></i> Add Slide
                        </button>
                    </div>
                    
                    <div id="outline-cards-container" class="space-y-3 max-h-80 overflow-y-auto border-2 border-indigo-100 rounded-2xl p-4 bg-gradient-to-br from-indigo-50/50 to-purple-50/50"></div>
                    
                    <div class="flex items-start gap-3 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl">
                        <i class="ph-fill ph-info text-blue-600 text-xl mt-0.5 flex-shrink-0"></i>
                        <div class="text-sm text-blue-700 font-semibold">
                            <strong>üí° Tip:</strong> Each card represents one slide. AI will generate detailed content based on your titles. You can add up to 20 slides.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Slide Count (Hidden when custom outline is active) -->
            <div id="slide-count-section" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-black uppercase text-slate-700 mb-3 tracking-wider">Slides Count</label>
                    <input type="number" id="slides_count" value="8" min="3" max="20" 
                           class="w-full text-center text-3xl font-black text-indigo-600 bg-gradient-to-br from-indigo-50 to-purple-50 border-2 border-indigo-300 rounded-xl py-4 outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 transition-all">
                </div>

                <div>
                    <label class="block text-sm font-black uppercase text-slate-700 mb-3 tracking-wider">AI Model</label>
                    <select id="ai_model" 
                            class="w-full p-4 border-2 border-indigo-200 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/20 font-bold text-indigo-700 cursor-pointer">
                        <option value="gemini" selected>üß† Gemini 2.5 Flash</option>
                        <option value="deepseek">üöÄ DeepSeek R1</option>
                    </select>
                </div>
            </div>

            <!-- Text Amount -->
            <div>
                <label class="block text-sm font-black uppercase text-slate-700 mb-3 tracking-wider flex items-center gap-2">
                    <i class="ph-duotone ph-text-align-left text-indigo-600"></i>
                    Text Amount
                </label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button onclick="selectTextAmount('minimal', this)" class="text-opt p-5 rounded-xl border-2 border-slate-200 hover:border-indigo-300 transition-all flex flex-col items-center gap-3">
                        <div class="space-y-1.5 w-14 opacity-40">
                            <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                            <div class="h-1 w-2/3 bg-slate-800 rounded-full"></div>
                        </div>
                        <span class="font-bold text-sm text-slate-600">Minimal</span>
                    </button>

                    <button onclick="selectTextAmount('concise', this)" class="text-opt active p-5 rounded-xl border-2 border-indigo-600 transition-all flex flex-col items-center gap-3">
                        <div class="space-y-1.5 w-14 text-indigo-600">
                            <div class="h-1.5 w-full bg-current rounded-full"></div>
                            <div class="h-1.5 w-full bg-current rounded-full"></div>
                            <div class="h-1.5 w-3/4 bg-current rounded-full"></div>
                        </div>
                        <span class="font-black text-sm text-indigo-700">Concise</span>
                    </button>

                    <button onclick="selectTextAmount('detailed', this)" class="text-opt p-5 rounded-xl border-2 border-slate-200 hover:border-indigo-300 transition-all flex flex-col items-center gap-3">
                        <div class="flex gap-1.5 w-16 opacity-40">
                            <div class="flex-1 space-y-1.5">
                                <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                                <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                            </div>
                            <div class="flex-1 space-y-1.5">
                                <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                            </div>
                        </div>
                        <span class="font-bold text-sm text-slate-600">Detailed</span>
                    </button>

                    <button onclick="selectTextAmount('extensive', this)" class="text-opt p-5 rounded-xl border-2 border-slate-200 hover:border-indigo-300 transition-all flex flex-col items-center gap-3">
                        <div class="flex gap-1.5 w-18 opacity-40">
                            <div class="flex-1 space-y-1.5">
                                <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                                <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                                <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                            </div>
                            <div class="flex-1 space-y-1.5">
                                <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                                <div class="h-1 w-full bg-slate-800 rounded-full"></div>
                            </div>
                        </div>
                        <span class="font-bold text-sm text-slate-600">Extensive</span>
                    </button>
                </div>
            </div>

            <!-- Theme Selection -->
            <div>
                <label class="block text-sm font-black uppercase text-slate-700 mb-3 tracking-wider flex items-center gap-2">
                    <i class="ph-duotone ph-palette text-indigo-600"></i>
                    Choose Theme
                </label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-5">
                    
                    <div onclick="selectTheme('dialogue', this)" class="theme-card active cursor-pointer rounded-xl border-2 border-indigo-600 overflow-hidden shadow-lg">
                        <div class="h-24 bg-white flex flex-col justify-center px-4">
                            <h4 class="font-serif text-xl text-slate-900">Title</h4>
                            <p class="text-xs text-slate-500 mt-1">Body & <span class="text-indigo-500 underline">link</span></p>
                        </div>
                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 py-2.5 px-4 border-t-2 border-indigo-200 flex items-center gap-2">
                            <i class="ph-fill ph-check-circle text-indigo-600 theme-check"></i>
                            <span class="text-xs font-black text-indigo-700 uppercase">Dialogue</span>
                        </div>
                    </div>

                    <div onclick="selectTheme('alien', this)" class="theme-card cursor-pointer rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg">
                        <div class="h-24 bg-slate-900 flex flex-col justify-center px-4 relative">
                            <div class="absolute inset-0 bg-gradient-to-br from-green-900/50 to-transparent"></div>
                            <h4 class="font-bold text-xl text-white relative z-10">Title</h4>
                            <p class="text-xs text-slate-300 mt-1 relative z-10">Body & <span class="text-green-400 font-bold">link</span></p>
                        </div>
                        <div class="bg-slate-50 py-2.5 px-4 border-t flex items-center gap-2">
                            <i class="ph-circle text-slate-300 theme-check"></i>
                            <span class="text-xs font-bold text-slate-600 uppercase">Alien</span>
                        </div>
                    </div>

                    <div onclick="selectTheme('wine', this)" class="theme-card cursor-pointer rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg">
                        <div class="h-24 bg-[#581c3c] flex flex-col justify-center px-4">
                            <h4 class="font-serif text-xl text-[#ffdec8]">Title</h4>
                            <p class="text-xs text-[#ffdec8]/70 mt-1">Body & <span class="underline">link</span></p>
                        </div>
                        <div class="bg-slate-50 py-2.5 px-4 border-t flex items-center gap-2">
                            <i class="ph-circle text-slate-300 theme-check"></i>
                            <span class="text-xs font-bold text-slate-600 uppercase">Wine</span>
                        </div>
                    </div>

                    <div onclick="selectTheme('snowball', this)" class="theme-card cursor-pointer rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg">
                        <div class="h-24 bg-slate-100 flex flex-col justify-center px-4 relative">
                            <div class="absolute top-2 right-2 w-10 h-10 bg-blue-200 rounded-full opacity-50"></div>
                            <h4 class="font-bold text-xl text-slate-800 relative z-10">Title</h4>
                            <p class="text-xs text-slate-500 mt-1 relative z-10">Body & <span class="text-blue-500 underline">link</span></p>
                        </div>
                        <div class="bg-slate-50 py-2.5 px-4 border-t flex items-center gap-2">
                            <i class="ph-circle text-slate-300 theme-check"></i>
                            <span class="text-xs font-bold text-slate-600 uppercase">Snowball</span>
                        </div>
                    </div>

                    <div onclick="selectTheme('petrol', this)" class="theme-card cursor-pointer rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg">
                        <div class="h-24 bg-slate-600 flex items-center justify-center p-3">
                            <div class="bg-white w-full h-full rounded flex flex-col justify-center px-3 shadow-sm">
                                <h4 class="font-bold text-base text-slate-700">Title</h4>
                                <span class="text-xs text-indigo-500 underline mt-1">link</span>
                            </div>
                        </div>
                        <div class="bg-slate-50 py-2.5 px-4 border-t flex items-center gap-2">
                            <i class="ph-circle text-slate-300 theme-check"></i>
                            <span class="text-xs font-bold text-slate-600 uppercase">Petrol</span>
                        </div>
                    </div>

                    <div onclick="selectTheme('piano', this)" class="theme-card cursor-pointer rounded-xl border-2 border-slate-200 overflow-hidden shadow-lg">
                        <div class="h-24 bg-black flex items-center justify-center relative">
                            <div class="absolute inset-0 bg-white" style="clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%)"></div>
                            <h4 class="font-bold text-xl relative z-10 mix-blend-difference text-white">Title</h4>
                        </div>
                        <div class="bg-slate-50 py-2.5 px-4 border-t flex items-center gap-2">
                            <i class="ph-circle text-slate-300 theme-check"></i>
                            <span class="text-xs font-bold text-slate-600 uppercase">Piano</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Generate Button -->
            <div class="pt-4">
                <button onclick="createPresentation()" 
                        id="btn-create" 
                        class="w-full py-5 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white rounded-2xl font-black text-xl hover:shadow-2xl hover:shadow-indigo-500/50 transition transform hover:scale-105 active:scale-95 flex items-center justify-center gap-3">
                    <i class="ph-fill ph-sparkle text-2xl"></i> 
                    <span>Generate Presentation</span>
                    <i class="ph-fill ph-rocket-launch text-2xl"></i>
                </button>
            </div>
            
            <!-- Status Area -->
            <div id="status-area" class="hidden text-center space-y-5 pt-4">
                <div class="h-3 bg-slate-100 rounded-full overflow-hidden w-full">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 w-0 transition-all duration-500"></div>
                </div>
                <p id="status-text" class="text-indigo-600 font-black animate-pulse text-base uppercase tracking-wide">Connecting to AI...</p>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-10 right-10 z-[100] flex flex-col gap-4 pointer-events-none"></div>

    <script>
        // ============================================================
        // GLOBAL VARIABLES
        // ============================================================
        let selectedTextAmount = 'concise';
        let selectedTheme = 'dialogue';
        const modal = document.getElementById('create-modal');
        
        // ============================================================
        // MODAL FUNCTIONS
        // ============================================================
        function openCreateModal() {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            setTimeout(() => document.getElementById('topic').focus(), 100);
        }
        
        function closeCreateModal() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            resetForm();
        }

        function resetForm() {
            document.getElementById('status-area').classList.add('hidden');
            document.getElementById('btn-create').classList.remove('hidden');
            document.getElementById('topic').value = '';
            document.getElementById('slides_count').value = '8';
            document.getElementById('use_custom_outline').checked = false;
            document.getElementById('outline-box').classList.add('hidden');
            document.getElementById('outline-cards-container').innerHTML = '';
            document.getElementById('progress-bar').style.width = '0%';
            selectedTextAmount = 'concise';
            selectedTheme = 'dialogue';
        }

        // ============================================================
        // CUSTOM OUTLINE FUNCTIONS
        // ============================================================
        function toggleOutline() {
            const checkbox = document.getElementById('use_custom_outline');
            const box = document.getElementById('outline-box');
            const slideCountSection = document.getElementById('slide-count-section');
            
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                box.classList.remove('hidden');
                slideCountSection.style.opacity = '0.5';
                slideCountSection.style.pointerEvents = 'none';
                
                // Auto-add 3 slides if empty
                if (document.getElementById('outline-cards-container').children.length === 0) {
                    addOutlineCard();
                    addOutlineCard();
                    addOutlineCard();
                }
            } else {
                box.classList.add('hidden');
                slideCountSection.style.opacity = '1';
                slideCountSection.style.pointerEvents = 'auto';
            }
        }

        function addOutlineCard() {
            const container = document.getElementById('outline-cards-container');
            const currentCount = container.children.length;
            
            if (currentCount >= 20) {
                showToast("‚ö†Ô∏è Maximum 20 slides allowed", "error");
                return;
            }
            
            const cardIndex = currentCount + 1;
            
            const card = document.createElement('div');
            card.className = 'flex items-center gap-3 bg-white border-2 border-indigo-200 rounded-xl p-4 hover:border-indigo-400 hover:shadow-lg transition group animate-scale-in';
            card.innerHTML = `
                <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white font-black shadow-lg">
                    ${cardIndex}
                </div>
                <input type="text" 
                       class="flex-1 outline-none text-base font-semibold text-slate-800 placeholder:text-slate-400 bg-transparent"
                       placeholder="Slide ${cardIndex} title (e.g., Why Resumes Still Matter ‚Äî And Why They Fail)">
                <button type="button" 
                        onclick="removeOutlineCard(this)" 
                        class="opacity-0 group-hover:opacity-100 p-2 hover:bg-red-50 text-red-500 rounded-lg transition transform hover:scale-110">
                    <i class="ph-bold ph-trash text-lg"></i>
                </button>
            `;
            container.appendChild(card);
            card.querySelector('input').focus();
        }

        function removeOutlineCard(button) {
            button.closest('div').remove();
            updateOutlineCardNumbers();
        }

        function updateOutlineCardNumbers() {
            const cards = document.getElementById('outline-cards-container').children;
            Array.from(cards).forEach((card, idx) => {
                card.querySelector('.flex-shrink-0').textContent = idx + 1;
                card.querySelector('input').placeholder = `Slide ${idx + 1} title (e.g., Core Features of Leading Smart Resume Analyzers)`;
            });
        }

        function getOutlineText() {
            const cards = document.getElementById('outline-cards-container').children;
            return Array.from(cards)
                .map(card => card.querySelector('input').value.trim())
                .filter(text => text.length > 0)
                .join('\n');
        }

        // ============================================================
        // SELECTION FUNCTIONS
        // ============================================================
        function selectTextAmount(amount, element) {
            selectedTextAmount = amount;
            
            document.querySelectorAll('.text-opt').forEach(el => {
                el.classList.remove('active', 'border-indigo-600', 'bg-gradient-to-br', 'from-indigo-50', 'to-purple-50');
                el.classList.add('border-slate-200');
                const bars = el.querySelectorAll('div > div');
                bars.forEach(b => {
                    b.classList.remove('bg-current');
                    b.classList.add('bg-slate-800');
                });
                el.querySelector('span').classList.remove('text-indigo-700', 'font-black');
                el.querySelector('span').classList.add('text-slate-600', 'font-bold');
                const container = el.querySelector('div');
                container.classList.add('opacity-40');
            });
            
            element.classList.add('active', 'border-indigo-600', 'bg-gradient-to-br', 'from-indigo-50', 'to-purple-50');
            element.classList.remove('border-slate-200');
            const activeBars = element.querySelectorAll('div > div');
            activeBars.forEach(b => {
                b.classList.add('bg-current');
                b.classList.remove('bg-slate-800');
            });
            element.querySelector('span').classList.add('text-indigo-700', 'font-black');
            element.querySelector('span').classList.remove('text-slate-600', 'font-bold');
            element.querySelector('div').classList.remove('opacity-40');
        }

        function selectTheme(theme, element) {
            selectedTheme = theme;
            
            document.querySelectorAll('.theme-card').forEach(el => {
                el.classList.remove('active', 'border-indigo-600');
                el.classList.add('border-slate-200');
                const icon = el.querySelector('.theme-check');
                icon.className = 'ph-circle text-slate-300 theme-check';
            });
            
            element.classList.add('active', 'border-indigo-600');
            element.classList.remove('border-slate-200');
            const icon = element.querySelector('.theme-check');
            icon.className = 'ph-fill ph-check-circle text-indigo-600 theme-check';
        }

        // ============================================================
        // PAGE INITIALIZATION
        // ============================================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ Dashboard loaded");
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login';
                return;
            }
            loadPresentations();
        });

        // ============================================================
        // LOAD PRESENTATIONS
        // ============================================================
        async function loadPresentations() {
            const grid = document.getElementById('presentations-grid');
            const loadingState = document.getElementById('loading-state');
            const emptyState = document.getElementById('empty-state');

            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/presentations/', { 
                    headers: { 'Authorization': `Bearer ${token}` } 
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();

                if (loadingState) loadingState.remove();

                if (data.presentations && data.presentations.length > 0) {
                    document.getElementById('presentation-count').textContent = data.presentations.length;
                    emptyState.classList.add('hidden');
                    
                    grid.innerHTML = data.presentations.map((p, index) => {
                        const slideCount = p.slides_count || p.total_slides || p.slides?.length || '?';
                        const theme = p.theme || 'dialogue';
                        const createdDate = p.created_at 
                            ? new Date(p.created_at).toLocaleDateString('en-US', { 
                                month: 'short', day: 'numeric', year: 'numeric' 
                              })
                            : 'Recently';

                        return `
                        <div class="presentation-card bg-white rounded-2xl shadow-xl border-2 border-slate-200 overflow-hidden flex flex-col relative group cursor-pointer animate-scale-in" 
                             style="animation-delay: ${index * 0.1}s"
                             onclick="window.location.href='/presentations/${p.id}'">
                            
                            <button onclick="deletePresentation('${p.id}', event)" 
                                    class="delete-btn absolute top-4 right-4 w-10 h-10 bg-white/95 rounded-full flex items-center justify-center text-red-500 hover:bg-red-50 hover:text-red-600 shadow-xl border-2 border-red-200 z-20 transform hover:scale-110 transition">
                                <i class="ph-bold ph-trash text-lg"></i>
                            </button>

                            <div class="h-52 bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center relative overflow-hidden">
                                <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.3) 0%, transparent 50%);"></div>
                                <i class="ph-duotone ph-slideshow text-7xl text-indigo-400 group-hover:scale-125 transition-transform duration-500 relative z-10"></i>
                            </div>

                            <div class="p-6 flex-1 flex flex-col bg-white">
                                <h3 class="font-black text-xl text-slate-900 line-clamp-2 mb-4 group-hover:text-indigo-600 transition-colors">
                                    ${p.title || p.prompt || 'Untitled'}
                                </h3>

                                <div class="flex items-center gap-3 flex-wrap text-xs font-black text-slate-500 uppercase tracking-wider mt-auto">
                                    <span class="bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 px-3 py-2 rounded-lg border border-indigo-200">
                                        <i class="ph-fill ph-stack mr-1"></i> ${slideCount} Slides
                                    </span>
                                    <span class="bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 px-3 py-2 rounded-lg border border-purple-200">
                                        <i class="ph-fill ph-palette mr-1"></i> ${theme}
                                    </span>
                                </div>

                                <div class="mt-5 pt-5 text-xs text-slate-400 font-bold border-t-2 border-slate-100 flex items-center gap-2">
                                    <i class="ph-fill ph-calendar-blank"></i>
                                    Created ${createdDate}
                                </div>
                            </div>
                        </div>`;
                    }).join('');
                } else {
                    grid.innerHTML = ''; 
                    emptyState.classList.remove('hidden');
                }
            } catch (error) {
                console.error("‚ùå Load error:", error);
                if (loadingState) loadingState.remove();
                
                grid.innerHTML = `
                    <div class="col-span-full text-center py-40">
                        <div class="w-20 h-20 bg-red-50 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-xl">
                            <i class="ph-bold ph-warning text-4xl text-red-500"></i>
                        </div>
                        <h3 class="text-2xl font-black text-slate-900 mb-3">Failed to Load</h3>
                        <p class="text-slate-600 mb-6 font-semibold">${error.message}</p>
                        <button onclick="loadPresentations()" 
                                class="px-8 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition transform hover:scale-105">
                            <i class="ph-bold ph-arrow-clockwise mr-2"></i> Retry
                        </button>
                    </div>`;
            }
        }

        // ============================================================
        // CREATE PRESENTATION
        // ============================================================
        async function createPresentation() {
            const topic = document.getElementById('topic').value.trim();
            if (!topic) return showToast("‚ùó Please enter a topic", "error");

            const useCustom = document.getElementById('use_custom_outline').checked;
            const customOutlineText = useCustom ? getOutlineText() : null;

            if (useCustom && (!customOutlineText || customOutlineText.trim() === '')) {
                return showToast("‚ùó Please add at least one slide title", "error");
            }

            document.getElementById('btn-create').classList.add('hidden');
            document.getElementById('status-area').classList.remove('hidden');
            
            let progress = 0;
            const statusText = document.getElementById('status-text');
            const steps = [
                "üîç Analyzing topic...", 
                "üß† Generating structure...", 
                "üé® Designing slides...", 
                "‚ú® Finalizing..."
            ];
            let stepIdx = 0;

            const progressInterval = setInterval(() => {
                progress = Math.min(progress + Math.random() * 8, 95);
                document.getElementById('progress-bar').style.width = progress + "%";
            }, 400);

            const stepInterval = setInterval(() => {
                statusText.innerText = steps[stepIdx++ % steps.length];
            }, 2000);

            try {
                const payload = {
                    prompt: topic,
                    slides_count: useCustom 
                        ? (document.getElementById('outline-cards-container').children.length || 8)
                        : parseInt(document.getElementById('slides_count').value, 10),
                    ai_model: document.getElementById('ai_model').value,
                    theme: selectedTheme,
                    text_amount: selectedTextAmount,
                    use_search: true,
                    style: 'professional',
                    custom_outline: customOutlineText
                };

                console.log("üì§ Payload:", payload);

                const token = localStorage.getItem('token');
                const response = await fetch('/api/presentations/generate', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}` 
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                clearInterval(progressInterval);
                clearInterval(stepInterval);

                if (response.ok && data.success) {
                    document.getElementById('progress-bar').style.width = "100%";
                    statusText.innerText = "‚úÖ Done! Opening...";
                    showToast("üéâ Created successfully!", "success");

                    const presId = data.presentation_id || (data.presentation && data.presentation.id);
                    if (presId) {
                        setTimeout(() => window.location.href = `/presentations/${presId}`, 1000);
                    } else {
                        throw new Error("Presentation ID missing");
                    }
                } else {
                    throw new Error(data.error || "Generation failed");
                }
            } catch (error) {
                clearInterval(progressInterval);
                clearInterval(stepInterval);
                console.error("‚ùå Error:", error);
                showToast("‚ùå " + error.message, "error");
                document.getElementById('btn-create').classList.remove('hidden');
                document.getElementById('status-area').classList.add('hidden');
            }
        }

        // ============================================================
        // DELETE PRESENTATION
        // ============================================================
        async function deletePresentation(id, event) {
            if (event) event.stopPropagation();
            if (!confirm("üóëÔ∏è Delete this presentation permanently?")) return;
            
            try {
                const token = localStorage.getItem('token');
                const res = await fetch(`/api/presentations/${id}`, { 
                    method: 'DELETE', 
                    headers: { 'Authorization': `Bearer ${token}` } 
                });
                
                if (res.ok) {
                    showToast("‚úÖ Deleted successfully", "success");
                    loadPresentations();
                } else {
                    const error = await res.json();
                    throw new Error(error.error || "Delete failed");
                }
            } catch (e) {
                console.error("‚ùå", e);
                showToast("‚ùå " + e.message, "error");
            }
        }

        // ============================================================
        // TOAST NOTIFICATION
        // ============================================================
        function showToast(msg, type = 'success') {
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-gradient-to-r from-green-500 to-emerald-500 border-green-600',
                error: 'bg-gradient-to-r from-red-500 to-pink-500 border-red-600'
            };
            
            toast.className = `flex items-center gap-4 px-6 py-4 rounded-2xl shadow-2xl pointer-events-auto backdrop-blur-md border-2 ${colors[type]} text-white font-bold text-base animate-slide-up`;
            toast.innerHTML = `
                <i class="ph-fill ${type === 'error' ? 'ph-warning-circle' : 'ph-check-circle'} text-2xl"></i>
                <span>${msg}</span>
            `;
            document.getElementById('toast-container').appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(20px)';
                setTimeout(() => toast.remove(), 300);
            }, 3500);
        }

        function logout() { 
            localStorage.removeItem('token'); 
            showToast("üëã Logged out successfully", "success");
            setTimeout(() => window.location.href = '/login', 1000);
        }
    </script>
</body>
</html>