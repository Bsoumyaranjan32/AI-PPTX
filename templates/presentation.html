<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamma Pro Editor</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ==============================
           THEME SYSTEM
           ============================== */
        :root {
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-muted: #475569;
            --border: #e2e8f0;
            --accent: #6366f1;
            --accent-light: #e0e7ff;
            --sidebar-bg: #0f172a; /* Dark section in split layout */
            --card-surface: #f8fafc; /* For inner cards like in Grid 4 */
        }

        [data-theme="wine"] {
            --bg: #4c1d33;
            --card-bg: #581c3c;
            --text-main: #ffffff;
            --text-muted: #f1c6d8;
            --border: rgba(255,255,255,0.15);
            --accent: #f472b6;
            --accent-light: rgba(244, 114, 182, 0.2);
            --sidebar-bg: #2d0b1e;
            --card-surface: rgba(0,0,0,0.2);
        }

        [data-theme="alien"] {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(255,255,255,0.1);
            --accent: #22d3ee;
            --accent-light: rgba(34, 211, 238, 0.15);
            --sidebar-bg: #020617;
            --card-surface: rgba(255,255,255,0.05);
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg); 
            color: var(--text-main);
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Nav & Common Elements Theme Overrides */
        nav { background: var(--card-bg) !important; border-color: var(--border) !important; }
        .text-slate-900 { color: var(--text-main) !important; }
        .text-slate-800 { color: var(--text-main) !important; }
        .text-slate-700 { color: var(--text-muted) !important; }
        .text-slate-600 { color: var(--text-muted) !important; }
        .text-slate-500 { color: var(--text-muted) !important; }
        .bg-white { background-color: var(--card-bg) !important; }
        .border-slate-200, .border-slate-300 { border-color: var(--border) !important; }
        
        /* Edit Mode Styles */
        .editable-active {
            border: 2px dashed var(--accent) !important;
            padding: 4px;
            border-radius: 4px;
            background: rgba(99, 102, 241, 0.05);
            outline: none;
        }
        
        /* Image Overlay */
        .image-overlay {
            opacity: 0;
            transition: opacity 0.2s;
            background: rgba(0,0,0,0.5);
            pointer-events: none;
        }
        .group:hover .image-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* Loader */
        .loader {
            border: 4px solid var(--border);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .grid-item-card {
            background: var(--card-surface) !important;
            border-color: var(--border) !important;
        }
        .grid-item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: var(--accent) !important;
        }

        /* ðŸ†• ROADMAP/TIMELINE STYLES (Slide 6) */
        .roadmap-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .roadmap-step {
            display: grid;
            grid-template-columns: 60px 1fr;
            gap: 1.5rem;
            position: relative;
        }

        .roadmap-number {
            width: 60px;
            height: 60px;
            background: var(--accent);
            color: var(--card-bg); /* Contrast text for number */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10;
            position: relative;
            flex-shrink: 0;
        }

        .roadmap-connector {
            position: absolute;
            left: 29px; /* Center of the 60px circle */
            top: 60px;
            width: 3px;
            height: calc(100% + 2rem); /* Connect to next item */
            background: linear-gradient(180deg, var(--accent), var(--border));
            z-index: 1;
        }

        .roadmap-connector.last {
            display: none;
        }

        .roadmap-content {
            background: var(--card-surface);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid var(--accent);
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .roadmap-content:hover {
            background: var(--accent-light);
            transform: translateX(8px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* Specific Layout Tweaks */
        .split-sidebar { background-color: var(--sidebar-bg) !important; }
        .text-accent { color: var(--accent) !important; }
        .bg-accent { background-color: var(--accent) !important; }
        .border-accent { border-color: var(--accent) !important; }
    </style>
</head>
<body class="text-slate-800">

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex justify-between items-center">
            
            <div class="flex items-center gap-4 flex-1">
                <a href="/dashboard" class="p-2 hover:bg-slate-100 rounded-lg text-slate-500">
                    <i class="ph-bold ph-arrow-left text-xl"></i>
                </a>
                <div>
                    <h1 id="pres-title" class="font-bold text-lg text-slate-900">Loading...</h1>
                    <p class="text-xs text-slate-500"><span id="slide-count">0</span> Slides</p>
                </div>
            </div>

            <div class="flex items-center gap-3">
                 <!-- Theme Selector -->
                 <select onchange="changeTheme(this.value)" class="bg-transparent border border-slate-300 rounded-lg px-2 py-1.5 text-xs font-bold mr-2 text-slate-700 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="default">Default Theme</option>
                    <option value="wine">Wine Theme</option>
                    <option value="alien">Alien Theme</option>
                </select>

                <button id="edit-btn" onclick="toggleEditMode()" class="flex items-center gap-2 px-4 py-2 bg-white border border-slate-300 hover:bg-slate-50 rounded-lg text-sm font-bold text-slate-700 transition">
                    <i class="ph-bold ph-pencil-simple"></i> <span id="edit-text">Edit</span>
                </button>

                <button id="save-btn" onclick="saveChanges()" class="hidden flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-bold shadow-lg">
                    <i class="ph-bold ph-floppy-disk"></i> Save
                </button>

                <button onclick="exportPPTX()" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-bold shadow-sm">
                    <i class="ph-bold ph-download-simple"></i> Export
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 py-10" id="main-container">
        <div id="loader" class="loader"></div>
        <div id="error-msg" class="hidden text-center text-red-500 font-bold mt-10"></div>
        <div id="slides-wrapper" class="space-y-12 hidden"></div>
    </main>

    <script>
        const pathSegments = window.location.pathname.split('/');
        const presId = pathSegments[pathSegments.length - 1] || pathSegments[pathSegments.length - 2]; 

        let isEditMode = false;
        let currentSlidesData = [];

        document.addEventListener('DOMContentLoaded', loadPresentation);

        // Theme Function
        function changeTheme(themeName) {
            if(themeName === 'default') {
                document.body.removeAttribute('data-theme');
            } else {
                document.body.setAttribute('data-theme', themeName);
            }
        }

        async function loadPresentation() {
            try {
                const token = localStorage.getItem('token');
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};

                console.log("Fetching presentation:", presId);
                const res = await fetch(`/api/presentations/${presId}`, { headers });
                
                if (!res.ok) throw new Error(`Server Error: ${res.status}`);
                
                const data = await res.json();

                if (data.success) {
                    const pres = data.presentation;
                    document.title = pres.title + " - Editor";
                    document.getElementById('pres-title').innerText = pres.title;
                    
                    const slides = pres.slides || [];
                    document.getElementById('slide-count').innerText = slides.length;
                    
                    if(slides.length === 0) {
                        document.getElementById('slides-wrapper').innerHTML = '<p class="text-center text-gray-500">No slides found.</p>';
                    } else {
                        renderSlides(slides);
                    }
                    
                    document.getElementById('slides-wrapper').classList.remove('hidden');
                } else {
                    throw new Error(data.error || "Failed to load");
                }
            } catch (e) {
                console.error("Load Error:", e);
                document.getElementById('error-msg').innerText = "Error: " + e.message;
                document.getElementById('error-msg').classList.remove('hidden');
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        function renderSlides(slides) {
            const container = document.getElementById('slides-wrapper');
            container.innerHTML = '';
            currentSlidesData = slides;

            slides.forEach((slide, index) => {
                try {
                    let layout = slide.layout || 'standard'; 
                    let slideHTML = '';
                    
                    const rawContent = slide.content || "No content available.";
                    const contentLines = rawContent.split('\n').filter(l => l && l.trim().length > 0);

                    // ===============================================
                    // ðŸ†• LAYOUT: ROADMAP (Slide 6 - Vertical Timeline)
                    // ===============================================
                    if (layout === 'roadmap') {
                        // Logic to parse "Title: Description" format
                        const steps = contentLines.slice(0, 6).map((line, i) => {
                            const cleanLine = line.replace(/^[0-9]+\.\s*/, '').replace(/[*#-]/g, '').trim();
                            // Split by colon to get Title vs Description
                            let parts = cleanLine.split(':');
                            let title = parts[0];
                            let desc = parts.slice(1).join(':'); // Rejoin if colon existed in description

                            if (!desc) {
                                // Fallback if no colon found
                                title = `Step ${i+1}`;
                                desc = cleanLine;
                            }

                            return {
                                title: title.trim(),
                                desc: desc.trim()
                            };
                        });

                        let stepsHTML = steps.map((step, i) => `
                            <div class="roadmap-step">
                                <div class="roadmap-connector ${i === steps.length - 1 ? 'last' : ''}"></div>
                                <div class="roadmap-number">${i + 1}</div>
                                <div class="roadmap-content">
                                    <h4 class="editable-line font-bold text-lg mb-1 text-slate-800">${step.title}</h4>
                                    <p class="editable-line text-sm text-slate-600 leading-relaxed">${step.desc}</p>
                                </div>
                            </div>
                        `).join('');

                        slideHTML = `
                        <div class="slide-card bg-white rounded-2xl shadow-lg border border-slate-200 p-10 min-h-[700px] flex flex-col group" data-index="${index}">
                            <div class="w-full mb-8 text-center">
                                <h2 class="slide-title text-4xl font-bold text-slate-900 mb-3 outline-none">${slide.title || 'Process Steps'}</h2>
                                <div class="w-24 h-1.5 bg-accent mx-auto rounded-full"></div>
                            </div>
                            
                            <div class="roadmap-container flex-1 slide-content outline-none">
                                ${stepsHTML}
                            </div>
                            
                            <div class="hidden image-section"><img src="${slide.image || ''}" class="slide-img"></div>
                            <div class="absolute top-4 left-4 bg-accent text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-lg">${index + 1}</div>
                        </div>`;
                    }

                    // ===============================================
                    // LAYOUT: SPLIT BOX (Slide 5)
                    // ===============================================
                    else if (layout === 'split_box') {
                        const intro = contentLines[0] || "Introduction text here...";
                        const points = contentLines.slice(1, 4);

                        // Using grid-item-card class for consistency with theme overrides
                        let gridHTML = `
                            <div class="grid-item-card p-4 rounded-lg border border-slate-200">
                                <h4 class="font-bold text-accent mb-1">01</h4>
                                <p class="editable-line text-sm text-slate-700 leading-tight">${(points[0] || 'Point 1').replace(/[*#-]/g, '')}</p>
                            </div>
                            <div class="grid-item-card p-4 rounded-lg border border-slate-200">
                                <h4 class="font-bold text-accent mb-1">02</h4>
                                <p class="editable-line text-sm text-slate-700 leading-tight">${(points[1] || 'Point 2').replace(/[*#-]/g, '')}</p>
                            </div>
                            <div class="col-span-2 grid-item-card p-4 rounded-lg border border-slate-200">
                                <h4 class="font-bold text-accent mb-1">03</h4>
                                <p class="editable-line text-sm text-slate-700 leading-tight">${(points[2] || 'Point 3').replace(/[*#-]/g, '')}</p>
                            </div>
                        `;

                        slideHTML = `
                        <div class="slide-card bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden flex flex-col md:flex-row min-h-[500px] group relative" data-index="${index}">
                            <div class="w-full md:w-5/12 relative image-section">
                                <img src="${slide.image || ''}" class="w-full h-full object-cover slide-img" onerror="this.style.display='none'">
                                <div class="image-overlay absolute inset-0 flex items-center justify-center z-20">
                                    <button onclick="changeImage(this)" class="bg-white text-indigo-600 px-4 py-2 rounded-full font-bold shadow-xl hover:bg-indigo-50"><i class="ph-bold ph-magic-wand"></i> Change</button>
                                </div>
                            </div>
                            
                            <div class="w-full md:w-7/12 p-8 flex flex-col split-sidebar bg-slate-900 text-white">
                                <h2 class="slide-title text-3xl font-bold mb-4 outline-none text-white !important">${slide.title}</h2>
                                <p class="slide-content text-slate-300 mb-6 text-sm outline-none text-white/80 !important">${intro}</p>
                                
                                <div class="bg-white/10 rounded-xl p-6 flex-1 flex flex-col justify-center text-slate-800">
                                    <div class="grid grid-cols-2 gap-4">
                                        ${gridHTML}
                                    </div>
                                </div>
                            </div>
                            <div class="absolute top-4 left-4 bg-white/20 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur z-20">${index + 1}</div>
                        </div>`;
                    }

                    // ===============================================
                    // LAYOUT: CENTERED (Slide 1)
                    // ===============================================
                    else if (layout === 'centered') {
                        slideHTML = `
                        <div class="slide-card relative rounded-2xl shadow-lg border border-slate-200 overflow-hidden min-h-[500px] flex items-center justify-center text-center group" data-index="${index}">
                            <div class="absolute inset-0 image-section">
                                <img src="${slide.image || ''}" class="w-full h-full object-cover brightness-[0.4] slide-img" onerror="this.style.display='none'">
                                <div class="image-overlay absolute inset-0 flex items-center justify-center z-20">
                                    <button onclick="changeImage(this)" class="bg-white text-indigo-600 px-4 py-2 rounded-full font-bold shadow-xl hover:bg-indigo-50"><i class="ph-bold ph-magic-wand"></i> Change</button>
                                </div>
                            </div>
                            <div class="relative z-10 p-12 max-w-4xl mx-auto">
                                <h2 class="slide-title text-5xl font-extrabold text-white mb-8 outline-none drop-shadow-lg text-white !important">${slide.title || 'Untitled'}</h2>
                                <div class="slide-content text-xl text-slate-100 font-medium leading-relaxed outline-none drop-shadow-md text-white/90 !important">
                                    ${formatContent(rawContent, true)}
                                </div>
                            </div>
                            <div class="absolute top-4 left-4 bg-white/20 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur z-20">${index + 1}</div>
                        </div>`;
                    }

                    // ===============================================
                    // LAYOUT: THREE COLUMNS
                    // ===============================================
                    else if (layout === 'three_col') {
                        // Replaced hardcoded bg-slate-800 with split-sidebar class which maps to theme
                        let colsHTML = contentLines.slice(0, 3).map((line, i) => `
                            <div class="grid-item-card p-6 rounded-xl border border-slate-700 flex-1 hover:border-accent transition">
                                <div class="text-4xl font-bold text-accent mb-4">${i+1}</div>
                                <p class="editable-line text-slate-200 text-sm font-medium leading-relaxed">${(line || '').replace(/[*#-]/g, '')}</p>
                            </div>
                        `).join('');
                        
                        slideHTML = `
                        <div class="slide-card split-sidebar bg-slate-900 text-white rounded-2xl shadow-lg p-10 min-h-[500px] flex flex-col justify-center group" data-index="${index}">
                            <div class="w-full mb-10">
                                <h2 class="slide-title text-4xl font-bold border-l-4 border-accent pl-4 outline-none text-white !important">${slide.title || 'Untitled'}</h2>
                            </div>
                            <div class="flex flex-col md:flex-row gap-6 w-full slide-content outline-none">
                                ${colsHTML || '<p class="text-slate-400">Add 3 points...</p>'}
                            </div>
                            <div class="hidden image-section"><img src="${slide.image || ''}" class="slide-img"></div>
                            <div class="absolute top-4 left-4 bg-white/10 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur">${index + 1}</div>
                        </div>`;
                    }

                    // ===============================================
                    // LAYOUT: GRID 4
                    // ===============================================
                    else if (layout === 'grid_4') {
                        let gridHTML = contentLines.slice(0, 4).map((line, i) => `
                            <div class="grid-item-card bg-indigo-50 p-6 rounded-xl border border-indigo-100 flex items-start gap-4 transition">
                                <div class="w-8 h-8 bg-accent rounded-full mt-1 shrink-0 flex items-center justify-center text-white font-bold text-sm">${i+1}</div>
                                <p class="editable-line text-slate-700 font-medium leading-relaxed">${(line || '').replace(/[*#-]/g, '')}</p>
                            </div>
                        `).join('');

                        slideHTML = `
                        <div class="slide-card bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden flex flex-col p-10 min-h-[500px] group" data-index="${index}">
                            <div class="w-full mb-8 text-center">
                                <h2 class="slide-title text-3xl font-bold text-slate-900 mb-2 outline-none">${slide.title || 'Untitled'}</h2>
                                <div class="w-20 h-1 bg-accent mx-auto rounded"></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full flex-1 slide-content outline-none">
                                ${gridHTML || '<p class="text-center text-slate-400">Add 4 points...</p>'}
                            </div>
                            <div class="hidden image-section"><img src="${slide.image || ''}" class="slide-img"></div>
                            <div class="absolute top-4 left-4 bg-slate-100 text-slate-500 text-xs font-bold px-2 py-1 rounded">${index + 1}</div>
                        </div>`;
                    }

                    // ===============================================
                    // LAYOUT: STANDARD (Default)
                    // ===============================================
                    else {
                        slideHTML = `
                        <div class="slide-card bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden flex flex-col md:flex-row min-h-[450px] group relative" data-index="${index}">
                            <div class="w-full md:w-1/2 relative bg-slate-100 image-section group">
                                <img src="${slide.image || ''}" class="w-full h-full object-cover slide-img" onerror="this.style.display='none'">
                                <div class="image-overlay absolute inset-0 flex items-center justify-center">
                                    <button onclick="changeImage(this)" class="bg-white text-indigo-600 px-4 py-2 rounded-full font-bold shadow-xl hover:bg-indigo-50"><i class="ph-bold ph-magic-wand"></i> Change</button>
                                </div>
                                <div class="absolute top-4 left-4 bg-black/50 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur">${index + 1}</div>
                            </div>
                            <div class="w-full md:w-1/2 p-10 flex flex-col justify-center">
                                <h2 class="slide-title text-3xl font-bold text-slate-900 mb-6 outline-none">${slide.title || 'Untitled'}</h2>
                                <div class="slide-content text-slate-600 space-y-4 outline-none text-lg leading-relaxed">
                                    ${formatContent(rawContent)}
                                </div>
                            </div>
                        </div>`;
                    }

                    container.insertAdjacentHTML('beforeend', slideHTML);
                
                } catch (err) {
                    console.error("Error rendering slide", index, err);
                }
            });
        }

        function formatContent(text, isDark = false) {
            if (!text) return '';
            const checkColor = isDark ? 'text-accent' : 'text-accent';
            return text.split('\n').map(line => {
                if(!line.trim()) return '';
                return `<div class="flex items-start gap-3"><i class="ph-fill ph-check-circle ${checkColor} mt-1 shrink-0"></i><p class="editable-line">${line.replace(/^[-*â€¢0-9.]\s*/, '')}</p></div>`;
            }).join('');
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('edit-btn');
            const saveBtn = document.getElementById('save-btn');
            const text = document.getElementById('edit-text');
            
            if (isEditMode) {
                text.innerText = 'Cancel';
                btn.classList.add('bg-slate-100', 'border-slate-300');
                saveBtn.classList.remove('hidden');
                document.querySelectorAll('.slide-title, .slide-content, .editable-line').forEach(el => {
                    el.contentEditable = "true";
                    el.classList.add('editable-active');
                });
                document.querySelectorAll('.image-overlay').forEach(el => el.classList.add('visible'));
            } else {
                text.innerText = 'Edit';
                btn.classList.remove('bg-slate-100', 'border-slate-300');
                saveBtn.classList.add('hidden');
                document.querySelectorAll('.slide-title, .slide-content, .editable-line').forEach(el => {
                    el.contentEditable = "false";
                    el.classList.remove('editable-active');
                });
                document.querySelectorAll('.image-overlay').forEach(el => el.classList.remove('visible'));
            }
        }

        function changeImage(btn) {
            const prompt = window.prompt("Enter image description:");
            if(!prompt) return;
            const img = btn.closest('.image-section').querySelector('.slide-img');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="ph-bold ph-spinner animate-spin"></i> ...';
            
            const newUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=800&height=600&nologo=true&t=${Date.now()}`;
            const temp = new Image();
            temp.src = newUrl;
            temp.onload = () => { img.src = newUrl; btn.innerHTML = originalText; img.style.display='block'; };
        }

        async function saveChanges() {
            const saveBtn = document.getElementById('save-btn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="ph-bold ph-spinner animate-spin"></i> Saving...';

            const newSlides = [];
            document.querySelectorAll('.slide-card').forEach((card, i) => {
                const title = card.querySelector('.slide-title').innerText;
                let img = "";
                const imgTag = card.querySelector('.slide-img');
                if (imgTag) img = imgTag.src;

                let content = "";
                const contentDiv = card.querySelector('.slide-content');
                if(contentDiv) content = contentDiv.innerText;

                const layout = currentSlidesData[i] ? currentSlidesData[i].layout : 'standard';
                newSlides.push({ title: title.trim(), content: content.trim(), image: img, layout: layout });
            });

            try {
                const token = localStorage.getItem('token');
                const headers = { 'Content-Type': 'application/json' };
                if (token) headers['Authorization'] = `Bearer ${token}`;

                const res = await fetch(`/api/presentations/${presId}`, {
                    method: 'PUT',
                    headers: headers,
                    body: JSON.stringify({ slides: newSlides })
                });

                if(res.ok) {
                    saveBtn.innerHTML = '<i class="ph-bold ph-check"></i> Saved!';
                    setTimeout(() => { toggleEditMode(); saveBtn.innerHTML = originalText; }, 1000);
                } else {
                    alert("Save failed.");
                    saveBtn.innerHTML = originalText;
                }
            } catch(e) {
                alert("Error saving: " + e);
                saveBtn.innerHTML = originalText;
            }
        }

        function exportPPTX() { window.location.href = `/api/presentations/${presId}/download/pptx`; }
    </script>
</body>
</html>